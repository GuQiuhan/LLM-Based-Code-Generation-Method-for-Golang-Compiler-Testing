// Code generated by cmd/cgo; DO NOT EDIT.

//line /bigdata/qiuhan/codet5/usage/goroot/misc/cgo/test/issue4029.go:1:1
// Copyright 2012 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

//go:build !windows && !static && (!darwin || (!internal_pie && !arm64))
// +build !windows
// +build !static
// +build !darwin !internal_pie,!arm64

// Excluded in darwin internal linking PIE mode, as dynamic export is not
// supported.
// Excluded in internal linking mode on darwin/arm64, as it is always PIE.

package cgotest

/*
#include <stdint.h>
#include <dlfcn.h>
#cgo linux LDFLAGS: -ldl

extern uintptr_t dlopen4029(char*, int);
extern uintptr_t dlsym4029(uintptr_t, char*);
extern int dlclose4029(uintptr_t);

extern void call4029(uintptr_t arg);
*/
import _ "unsafe"

import (
	"testing"
)

var callbacks int

//export IMPIsOpaque
func IMPIsOpaque() {
	callbacks++
}

//export IMPInitWithFrame
func IMPInitWithFrame() {
	callbacks++
}

//export IMPDrawRect
func IMPDrawRect() {
	callbacks++
}

//export IMPWindowResize
func IMPWindowResize() {
	callbacks++
}

func test4029(t *testing.T) {
	loadThySelf(t, "IMPWindowResize")
	loadThySelf(t, "IMPDrawRect")
	loadThySelf(t, "IMPInitWithFrame")
	loadThySelf(t, "IMPIsOpaque")
	if callbacks != 4 {
		t.Errorf("got %d callbacks, expected 4", callbacks)
	}
}

func loadThySelf(t *testing.T, symbol string) {
	this_process := ( /*line :66:18*/_Cfunc_dlopen4029 /*line :66:29*/)(nil, ( /*line :66:36*/_Ciconst_RTLD_NOW /*line :66:45*/))
	if this_process == 0 {
		t.Error("dlopen:", ( /*line :68:22*/_Cfunc_GoString /*line :68:31*/)(( /*line :68:33*/_Cfunc_dlerror /*line :68:41*/)()))
		return
	}
	defer ( /*line :71:8*/_Cfunc_dlclose4029 /*line :71:20*/)(this_process)

	symbol_address := ( /*line :73:20*/_Cfunc_dlsym4029 /*line :73:30*/)(this_process, ( /*line :73:46*/_Cfunc_CString /*line :73:54*/)(symbol))
	if symbol_address == 0 {
		t.Error("dlsym:", ( /*line :75:21*/_Cfunc_GoString /*line :75:30*/)(( /*line :75:32*/_Cfunc_dlerror /*line :75:40*/)()))
		return
	}
	t.Log(symbol, symbol_address)
	( /*line :79:2*/_Cfunc_call4029 /*line :79:11*/)(symbol_address)
}
