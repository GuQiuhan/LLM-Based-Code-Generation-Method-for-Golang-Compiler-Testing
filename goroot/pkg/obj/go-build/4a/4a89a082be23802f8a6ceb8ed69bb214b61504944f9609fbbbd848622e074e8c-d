// Code generated by cmd/cgo; DO NOT EDIT.

//line /bigdata/qiuhan/codet5/usage/goroot/misc/cgo/test/sigprocmask.go:1:1
// Copyright 2015 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

//go:build !windows
// +build !windows

package cgotest

/*
#cgo CFLAGS: -pthread
#cgo LDFLAGS: -pthread
extern int RunSigThread();
extern int CheckBlocked();
*/
import _ "unsafe"
import (
	"os"
	"os/signal"
	"syscall"
	"testing"
)

var blocked bool

//export IntoGoAndBack
func IntoGoAndBack() {
	// Verify that SIGIO stays blocked on the C thread
	// even when unblocked for signal.Notify().
	signal.Notify(make(chan os.Signal), syscall.SIGIO)
	blocked = ( /*line :31:12*/_Cfunc_CheckBlocked /*line :31:25*/)() != 0
}

func testSigprocmask(t *testing.T) {
	if r := ( /*line :35:10*/_Cfunc_RunSigThread /*line :35:23*/)(); r != 0 {
		t.Errorf("pthread_create/pthread_join failed: %d", r)
	}
	if !blocked {
		t.Error("Go runtime unblocked SIGIO")
	}
}
