// Code generated by cmd/cgo; DO NOT EDIT.

//line /bigdata/qiuhan/codet5/usage/goroot/misc/cgo/testsanitizers/testdata/tsan.go:1:1
// Copyright 2015 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

package main

// This program produced false race reports when run under the C/C++
// ThreadSanitizer, as it did not understand the synchronization in
// the Go code.

/*
#cgo CFLAGS: -fsanitize=thread
#cgo LDFLAGS: -fsanitize=thread

int val;

int getVal() {
	return val;
}

void setVal(int i) {
	val = i;
}
*/
import _ "unsafe"

import (
	"runtime"
)

func main() {
	runtime.LockOSThread()
	( /*line :33:2*/_Cfunc_setVal /*line :33:9*/)(1)
	c := make(chan bool)
	go func() {
		runtime.LockOSThread()
		( /*line :37:3*/_Cfunc_setVal /*line :37:10*/)(2)
		c <- true
	}()
	<-c
	if v := ( /*line :41:10*/_Cfunc_getVal /*line :41:17*/)(); v != 2 {
		panic(v)
	}
}
